## Оценка риска ДТП

Нам поступил заказ от каршеринговой компании: нужно создать систему, которая могла бы оценить риск ДТП по выбранному маршруту движения. Под риском понимается вероятность ДТП с любым повреждением транспортного средства. Как только водитель забронировал автомобиль, сел за руль и выбрал маршрут, система должна оценить уровень риска. Если уровень риска высок, водитель увидит предупреждение и рекомендации по маршруту.

Идея создания такой системы находится в стадии предварительного обсуждения и проработки. Чёткого алгоритма работы и подобных решений на рынке ещё не существует. Текущая задача — понять, возможно ли предсказывать ДТП, опираясь на исторические данные одного из регионов.

Идея решения задачи от заказчика: 
1. Создать модель предсказания ДТП (целевое значение — at_fault (виновник) в таблице parties) 
- Для модели выбрать тип виновника — только машина (car).
- Выбрать случаи, когда ДТП привело к любым повреждениям транспортного средства, кроме типа SCRATCH (царапина).
- Для моделирования ограничиться данными за 2012 год — они самые свежие.
- Обязательное условие — учесть фактор возраста автомобиля.
2. На основе модели исследовать основные факторы ДТП.
3. Понять, помогут ли результаты моделирования и анализ важности факторов ответить на вопросы: 
- Возможно ли создать адекватную системы оценки водительского риска при выдаче авто?
- Какие ещё факторы нужно учесть?
- Нужно ли оборудовать автомобиль какими-либо датчиками или камерой?

Заказчик предлагает поработать с базой данных по происшествиям и сформировать свои идеи создания такой системы.

## Использованные инструменты
- python
- numpy
- pandas
- catboost
- catboost.CatBoostClassifier
- lightgbm
- matplotlib.pyplot
- re
- seaborn
- statistics
- math
- phik
- phik.report
- phik.report.plot_correlation_matrix
- random
- sqlalchemy.create_engine
- sklearn.compose.ColumnTransformer
- sklearn.ensemble.RandomForestClassifier
- sklearn.linear_model.LogisticRegression
- sklearn.metrics.accuracy_score
- sklearn.metrics.confusion_matrix
- sklearn.metrics.f1_score
- sklearn.metrics.precision_recall_curve
- sklearn.metrics.PrecisionRecallDisplay
- sklearn.metrics.precision_score
- sklearn.metrics.recall_score
- sklearn.metrics.roc_auc_score
- sklearn.metrics.roc_curve
- sklearn.model_selection.cross_val_score
- sklearn.model_selection.GridSearchCV
- sklearn.model_selection.train_test_split
- sklearn.preprocessing.LabelBinarizer
- sklearn.preprocessing.OneHotEncoder
- sklearn.preprocessing.StandardScaler
- from sklearn.tree.DecisionTreeClassifier
- skorch.NeuralNetRegressor
- skorch.callbacks.EpochScoring
- skorch.callbacks.EarlyStopping
- skorch.dataset.ValidSplit
- torch
- torch.nn
- torchvision
- torchvision.transforms
- torch.utils.data.Dataset
- torch.utils.data.DataLoader
- time
- tqdm

## Результат

Испытали четыре модели обычения. Они показали следующие результаты:

|  | Recall | LearningTime | PredictTime |
|:------ |:-----:|:-----:|:------:|
| DecisionTreeClassifier | 50.19% | 2.04 | 0.02 |
| RandomForestClassifier | 56.76% | 34.44 | 0.93 |
| LGBMClassifier | 52.33% | 1.21 | 0.10 |
| CatBoostClassifier | 57.27% | 10.87 | 0.05 |

Лучшие показатели метрики Recall показала модель CatBoost. Поэтому выберем её для получения предсказаний на тестовой выборке.

Нам удалось обучить модель на тестовых данных и получить метрику Recall равную 57%, precision - 69.7%, а f1 - 62.7%. Это недостаточно хороший показатель, однако на предсказаниях мы имеем:

неправильно угадываем порядка 24% данных, которые относятся к первому классу чаще всего мы будем угадывать класс 1 - в районе 29% данных. Это не может не радовать. класс 0 мы будем угадывать в 24% от случая. а наименьший процент из всех представленных - неудачные предсказания класса 0 (19%) Если отвечать на первоначальный вопрос: "Возможно ли прогнозировать?", я бы сказал нет, точнее, не на этих данных. Будем честны, большинство факторов из выборки будут известны уже после проишествия. Нам же нужны совсем иные данные, которые мы будем знать только, когда человек сел в машину и выбрал маршрут. К примеру, я бы добавил в таблицу характеристик клиента следующие факторы:

возраст водителя, который будет прямо влиять на время реакции, стаж, от этого будет зависить как он поведёт себя в той или иной ситуации среднюю сокорость вождения количество нарушений за всё время за рулём возможно, можно провести исследования и добавить сюда место работы, ведь те же таксисты и водители дального следования, скорее всего, будут реже попадать в подобные ситуации, чем пилоты самолёта. Вообщем характеристики самой "личности" человека, чтобы было понятно кто именно сел за руль. Тогда, возможно, у нас будет вероятность обучить модель выше 70% по метрике recall.