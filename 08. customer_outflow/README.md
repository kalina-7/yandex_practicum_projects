# Прогнозирование оттока клиентов в сети отелей «Как в гостях»

## Описание проекта

Заказчик этого исследования — сеть отелей «Как в гостях». 

Чтобы привлечь клиентов, эта сеть отелей добавила на свой сайт возможность забронировать номер без предоплаты. Однако если клиент отменял бронирование, то компания терпела убытки. Сотрудники отеля могли, например, закупить продукты к приезду гостя или просто не успеть найти другого клиента.

Чтобы решить эту проблему, вам нужно разработать систему, которая предсказывает отказ от брони. Если модель покажет, что бронь будет отменена, то клиенту предлагается внести депозит. Размер депозита — 80% от стоимости номера за одни сутки и затрат на разовую уборку. Деньги будут списаны со счёта клиента, если он всё же отменит бронь.

## Бизнес-метрика и другие данные
Основная бизнес-метрика для любой сети отелей — её прибыль. Прибыль отеля — это разница между стоимостью номера за все ночи и затраты на обслуживание: как при подготовке номера, так и при проживании постояльца. 

В отеле есть несколько типов номеров. В зависимости от типа номера назначается стоимость за одну ночь. Есть также затраты на уборку. Если клиент снял номер надолго, то убираются каждые два дня. 

Стоимость номеров отеля:
- категория A: за ночь — 1 000, разовое обслуживание — 400;
- категория B: за ночь — 800, разовое обслуживание — 350;
- категория C: за ночь — 600, разовое обслуживание — 350;
- категория D: за ночь — 550, разовое обслуживание — 150;
- категория E: за ночь — 500, разовое обслуживание — 150;
- категория F: за ночь — 450, разовое обслуживание — 150;
- категория G: за ночь — 350, разовое обслуживание — 150.

В ценовой политике отеля используются сезонные коэффициенты: весной и осенью цены повышаются на 20%, летом — на 40%.

Убытки отеля в случае отмены брони номера — это стоимость одной уборки и одной ночи с учётом сезонного коэффициента.

На разработку системы прогнозирования заложен бюджет — 400 000. При этом необходимо учесть, что внедрение модели должно окупиться за тестовый период. Затраты на разработку должны быть меньше той выручки, которую система принесёт компании.

## Описание данных
В таблицах `hotel_train` и `hotel_test` содержатся одинаковые столбцы:
- `id` — номер записи;
- `adults` — количество взрослых постояльцев;
- `arrival_date_year` — год заезда;
- `arrival_date_month` — месяц заезда;
- `arrival_date_week_number` — неделя заезда;
- `arrival_date_day_of_month` — день заезда;
- `babies` — количество младенцев;
- `booking_changes` — количество изменений параметров заказа;
- `children` — количество детей от 3 до 14 лет;
- `country` — гражданство постояльца;
- `customer_type` — тип заказчика:
	- `Contract` — договор с юридическим лицом;
	- `Group` — групповой заезд;
	- `Transient` — не связано с договором или групповым заездом;
	- `Transient-party` — не связано с договором или групповым заездом, но связано с бронированием типа `Transient`.
- `days_in_waiting_list` — сколько дней заказ ожидал подтверждения;
- `distribution_channel` — канал дистрибуции заказа;
- `is_canceled` — отмена заказа;
- `is_repeated_guest` — признак того, что гость бронирует номер второй раз;
- `lead_time` — количество дней между датой бронирования и датой прибытия;
- `meal` — опции заказа:
	- `SC` — нет дополнительных опций;
	- `BB` — включён завтрак;
	- `HB` — включён завтрак и обед;
	- `FB` — включён завтрак, обед и ужин.
- `previous_bookings_not_canceled` — количество подтверждённых заказов у клиента;
- `previous_cancellations` — количество отменённых заказов у клиента;
- `required_car_parking_spaces` — необходимость места для автомобиля;
- `reserved_room_type` — тип забронированной комнаты;
- `stays_in_weekend_nights` — количество ночей в выходные дни;
- `stays_in_week_nights` — количество ночей в будние дни;
- `total_nights` — общее количество ночей;
- `total_of_special_requests` — количество специальных отметок.

## Использованные инструменты
- *python*
- *numpy*
- *pandas*
- *seaborn*
- *matplotlib.pyplot*
- *sklearn.metrics.mean_squared_error*
- *sklearn.metrics.make_scorer*
- *sklearn.metrics.RocCurveDisplay*
- *sklearn.metrics.accuracy_score*
- *sklearn.metrics.confusion_matrix*
- *sklearn.metrics.f1_score*
- *sklearn.metrics.precision_score*
- *sklearn.metrics.recall_score*
- *sklearn.metrics.roc_auc_score*
- *sklearn.metrics.roc_curve*
- *sklearn.model_selection.train_test_split*
- *sklearn.linear_model.LinearRegression*
- *sklearn.datasets.make_classification*
- *sklearn.preprocessing.OneHotEncoder*
- *sklearn.preprocessing.StandardScaler*
- *sklearn.dummy.DummyClassifier*
- *sklearn.ensemble.RandomForestClassifier*
- *sklearn.tree.DecisionTreeClassifier*
- *sklearn.linear_model.LogisticRegression*
- *sklearn.model_selection.GridSearchCV*
- *sklearn.model_selection.cross_val_score*
- *sklearn.utils.shuffle*

## Общий вывод

После изучения данных провели их предобработку - удалили неинформативный столбец id, выявили дубликаты, но их наличие объяснимо, поэтому их оставили. Исправили ошибки в категориальных столбцах.

Провели исследовательский анализ. Выявили дисбалланс целевого признака, отменяется около 38% бронирования. Выявили незначительные выбросы в признаках. Выявили наиболее коррелирующие с целевым признаки - количество взрослых постояльцев, количество отменённых заказов у клиента, сколько дней заказ ожидал подтверждения, количество специальных отметок, необходимость места для автомобиля, количество изменений параметров заказа.

В период с весны по осень бронирований больше, чем в зимние месяцы, однако в августе и сентябре наблюдается уменьшение количества бронирований.

Подготовили данные для ML. Посчитали прибыль отеля без внедрения депозита. Она составила 32597770.0 руб.
Для удобства исследования создали новые датафреймы и присоединили их к основным.
Закодировали категориальные данные методом OneHotEncoder. Объединили закодированные данные с исходными датафреймами, удалили исходные категориальные столбцы и сохранили полученные данные в новых датафреймах.
Разделили новые датафреймы на целевые и обучающие выборки и масштабировали данные.

Далее мы обучили три модели - Логистическая регрессия, Дерево решений, Случайный лес. В качестве целевой метрики выбрали метрику f1. Она наиболее важна для нашей задачи. Модель Логистическая регрессия показала наилучшие метрики. Матрица ошибок модели Логистическая регрессия тоже показала наилучший результат. Прибыль при использовании модели Логистическая регрессия наивысшая - 13629936.0 руб., что гораздо выше 400000 руб. затраченных на её разработку.

Оценили портрет ненадёжного клиента. Выяснили, что самые ненадёжные клиенты бронируют комнату задолго до заезда. Наличие особых запросов, количество отменённых заказов у клиента - тоже повышают вероятность отмены бронирования. Увеличивают риск отмены бронирования клиенты из категория заказчика Transient, днлающие бронь по каналу дистрибуции ТА/ТО, выбирающие тип забронированной комнаты A, B, C, G. Самые ненадёжные клиенты приезжают из Португалии, хотя они же и делают максимальное количество заказов в сравнении с гостями из других стран.