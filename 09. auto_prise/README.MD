## Разработка модели предсказания стоимости автомобиля на вторичном рынке.

## Цель проекта - разработка модели предварительной оценки стоимости автомобиля на вторичном рынке.

## Задачи, которые необходимо выполнить для достижения цели:
- загрузка необходимых библиотек и инструментов;
- загрузка и изучение предоставленных датафреймов - тренировочного, на основе которого будет разрабатываться модель, и тестового;
- предварительная обработка данных: 
    - проверка на дубликаты, 
    - заполнение выявленных пропусков в данных, подобранным для каждого столбца способом;
- на основе предварительного анализа создадим столбцы с новыми признаками;
- закодируем категориальные признаки;
- изучим корреляцию между признаками;
- проведём отбор признаков для обучения модели;
- выберем модели обучения;
- с помощью кроссвалидации на тренеровочном датафрейме подберём гиперпараметры для выбранных моделей;
- обучим модели и выберем лучшую модель по метрике MAPE;
- получим предсказание модели на предоставленном тестовом датафрейме.

## Использованные инструменты
- python
- numpy
- pandas
- catboost.CatBoostRegressor
- catboost.Pool
- catboost.cv
- category_encoders
- datetime
- sklearn.metrics.mean_absolute_percentage_error
- sklearn.model_selection.train_test_split
- sklearn.utils.shuffle
- tqdm

## Результат 

Нам была поставлена цель проекта - разработка модели предварительной оценки стоимости автомобиля на вторичном рынке. Для её достижения нами были поставлены и выполнены следующие задачи:
- загружены необходимые библиотеки и инструменты;
- загружены и изучены предоставленные датафреймы - тренировочный, на основе которого разрабатываем модель, и тестовый;
- произведена предварительная обработка данных: 
    - проверка на дубликаты, 
    - заполнение выявленных пропусков в данных, подобранным для каждого столбца способом;
- на основе предварительного анализа создали столбцы с новыми признаками;
- закодировали категориальные признаки;
- изучили корреляцию между признаками;
- провели отбор признаков для обучения модели;
- выбрали модели обучения;
- с помощью кроссвалидации на тренеровочном датафрейме подобрали гиперпараметры для выбранных моделей;
- обучили модели и выбрали лучшую модель по метрике MAPE - CatBoostRegressor;
- получили предсказание модели на предоставленном тестовом датафрейме.

При предобработке данных были выявлены пропуски в некоторых столбцах. Возникли трудности с их заполнением. Но способы корректного заполнения этих пропусков были найдены. В столбце `make` - производитель, обнаружено 8043 пропусков, а также неявные дубликаты. Привели название марок к единому виду. В столбцах `make` и `model` большее колиство пропусков заполнили по первым знакам столбца vin в строках с пропусками, взятыми значениями из заполненных строк. Оставшиеся пропуски заполнили заглушкой "unknown". В столбце `body` - тип кузова, обнаружено 10393 пропусков, а также неявные дубликаты. Привели название типов кузовов к единому виду. Пропуски заполнили заглушкой "unknown". В столбце `trim` - модификация, обнаружено 8337 пропусков, а также неявные дубликаты. Пропуски заполнили заглушкой "unknown". В столбце `transmission` - тип КПП, обнаружено 51461 пропусков, а также неявные дубликаты. Так как абсолюьное большинство автомобилей имеют автоматическую коробку передач, то пропуски заполнили значением "automatic". В столбце `condition` - состояние по шкале (1-5), обнаружено 9405 пропусков. Использовал функцию, которая заполняет пропуски медианным значением в зависимости от года выпуска авто. В столбце `odometer` - пробег в милях, обнаружено 69 пропусков. Использовал функцию, которая заполняет пропуски медианным значением в зависимости от года выпуска авто. В столбце `color` - цвет кузова, обнаружено 586 пропусков. Заполнил пропуски значением "—". В столбце `interior` - цвет интерьера, обнаружено 586 пропусков. Заполнил пропуски значением "—". Добавили новые признаки - `sale_month` - месяц продажи и `sale_year` - год продажи, для этого привели столбец с датой столбец `saledate` с датой продажи к типу .daytime и извлекли из него месяц и год.

Для обучения были выбраны четыре модели - Случайный лес, Дерево решений, Линейная регрессия и CatBoostRegressor. Для подбора гиперпараметров применили кроссвалидацию. CatBoostRegressor оказалась наилучшей моделью, её MAPE оказалась самой низкой - 0.16099. Поэтому было решено выбрать её. Для улучшения результатов обучения модели предварительно закодировали категориальные признаки методом TargetEncoder. Для обучения модели были выбраны все признаки кроме `vin`, так как он имеет коэффициент корреляции 1, т.е. имеет мультиколлинеарность с целевым признаком.

После получения предсказания на тестовом датафрейме, увидели, что некоторое количество предсказанных значений стоимости автомобиля имеет отрицательное значение, хотя такого быть не может. Было решено заменить эти значения на значение 1-го перцентиля - 524 доллара.

По результатам проверки модели убедились, что модель является работоспособной и надёжной, имеет низкую MAPE и может применяться для предварительного расчёта стоимости автомобиля на вторичном рынке.

Для улучшения модели и её метрики качества можно проделать дополнительную работу по более корректному заполнению пропусков - найти и выделить новые признаки на основе более углублённого анализа данных. Также имеет смысл поработать с подбором большего количества гипермараметров. Кроме того необходимо раз в шесть месяцев проводить дообучение модели - брать данные о продажах на вторичном рынке за последние полгода, так как появляются новые модели, отсутствующие в старом датафрейме, а старые модели дешевеют, поэтому предсказания будут менее точны.